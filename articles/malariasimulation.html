<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bed nets in malariasimulation â€¢ netz</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bed nets in malariasimulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">netz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/malariasimulation.html">Bed nets in malariasimulation</a></li>
    <li><a class="dropdown-item" href="../articles/Metrics.html">Converting between bed net metrics</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bed nets in malariasimulation</h1>
            
      

      <div class="d-none name"><code>malariasimulation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">netz</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">malariasimulation</span><span class="op">)</span></span></code></pre></div>
<p>In <a href="https://mrc-ide.github.io/malariasimulation/" class="external-link">malariasimulation</a>
we can implement the <a href="https://mrc-ide.github.io/malariasimulation/articles/VectorControl.html" class="external-link">bed
net intervention</a> by specifying the % of the population who are
distributed a bed net (and assumed to use it) at given time points.</p>
<p>We often want to match malariasimulation distributions so that they
result in and observed time-series of usage that we have data for. The
netz package can help us to do this.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create some example usage data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2009</span>,</span>
<span>  usage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate the model inputs to achieve the observed usage</span></span>
<span><span class="co">## We assume that</span></span>
<span><span class="co">## Usage is measured at the mid point of the year</span></span>
<span><span class="co">## Distributions occur at the start of the year</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">model_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/usage_to_model_distribution.html">usage_to_model_distribution</a></span><span class="op">(</span></span>
<span>  usage <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">usage</span>,</span>
<span>  usage_timesteps <span class="op">=</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">365</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  distribution_timesteps <span class="op">=</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  mean_retention <span class="op">=</span> <span class="fl">700</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate model usage over time to validate</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">$</span><span class="va">model_usage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_distribution_to_usage.html">model_distribution_to_usage</a></span><span class="op">(</span></span>
<span>  usage_timesteps <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">t</span>,</span>
<span>  distribution <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">model_input</span>,</span>
<span>  distribution_timesteps <span class="op">=</span>  <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  mean_retention <span class="op">=</span> <span class="fl">700</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate with usage outputs from a malariasimulation run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">365</span></span>
<span><span class="va">sim_length</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="va">year</span></span>
<span><span class="va">human_population</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">starting_EIR</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/malariasimulation/man/get_parameters.html" class="external-link">get_parameters</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>human_population <span class="op">=</span> <span class="va">human_population</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/malariasimulation/man/set_equilibrium.html" class="external-link">set_equilibrium</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="va">starting_EIR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/malariasimulation/man/set_bednets.html" class="external-link">set_bednets</a></span><span class="op">(</span></span>
<span>    timesteps <span class="op">=</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    coverages <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">model_input</span>,</span>
<span>    retention <span class="op">=</span> <span class="fl">700</span>,</span>
<span>    dn0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.533</span>, <span class="fl">10</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    rn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.56</span>, <span class="fl">10</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    rnm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.24</span>, <span class="fl">10</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    gamman <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2.64</span> <span class="op">*</span> <span class="fl">365</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">validate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/malariasimulation/man/run_simulation.html" class="external-link">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">sim_length</span>, parameters <span class="op">=</span> <span class="va">simparams</span><span class="op">)</span></span>
<span><span class="va">validate</span><span class="op">$</span><span class="va">model_use</span> <span class="op">&lt;-</span> <span class="va">validate</span><span class="op">$</span><span class="va">n_use_net</span> <span class="op">/</span> <span class="va">simparams</span><span class="op">$</span><span class="va">human_population</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2000</span> <span class="op">+</span> <span class="op">(</span><span class="va">t</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">model_usage</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">validate</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2000</span> <span class="op">+</span> <span class="op">(</span><span class="va">timestep</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">model_use</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"forestgreen"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span> <span class="op">+</span> <span class="fl">0.5</span>, y <span class="op">=</span> <span class="va">usage</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"darkred"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Predicted model usage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2010</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="malariasimulation_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>In some cases, the function may struggle to fit the usage
observations well. This may especially be the case if we are uncertain
about bed net parameters, such as the rate of net loss, or if early data
points are spurious.</p>
<p>Please note, that in these functions we <em>always</em> use the
<code><a href="../reference/net_loss_exp.html">net_loss_exp()</a></code> net retention function, as this aligns with
the internal implementation in malariasimulation.</p>
<p>These function assumed <em>random</em> correlation between
recipients.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pete Winskill, Nora Schmit, Ines Gerard-Ursin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
